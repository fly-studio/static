/*! jquery.uploader.js 2016-11-20 03:56:08*/
!function(e){if(e.UPLOADER_LANGUAGE={close:"\u5173\u95ed",drop_container:"\u62d6\u5230\u6587\u4ef6\u5230\u8fd9\u91cc",drop_tips:"\u652f\u6301\u4eceWindows\u4e2d\u62d6\u52a8\u6587\u4ef6\u5230\u8fd9\u91cc\u4e0a\u4f20\uff08\u9700\u73b0\u4ee3\u6d4f\u89c8\u5668\uff09",drop_button:"\u62d6\u653e\u6587\u4ef6",select_file:"\u9009\u62e9\u6587\u4ef6",ctrl_v_tips:"\u53ef\u4ee5\u4f7f\u7528Ctrl+V\u76f4\u63a5\u7c98\u8d34\u622a\u56fe\uff08\u9700\u73b0\u4ee3\u6d4f\u89c8\u5668\uff09",ctrl_v_button:"Ctrl+V \u622a\u56fe",resize:"\u56fe\u7247\u4f1a\u81ea\u52a8\u7b49\u6bd4\u7f29\u653e\u81f3\uff1a{0} (\u4ec5jpg)",uploading:"\u6b63\u5728\u4e0a\u4f20\u6587\u4ef6...",success:"\u4e0a\u4f20\u6210\u529f!",rotate_right:"\u5411\u53f3\u65cb\u8f6c",rotate_left:"\u5411\u5de6\u65cb\u8f6c",loading:"\u6b63\u5728\u8f7d\u5165...",reading:"\u6587\u4ef6\u8bfb\u53d6\u4e2d...",filetype:"\u8bf7\u4e0a\u4f20{0}\u6587\u4ef6!",filenum_limite:"\u53ea\u5141\u8bb8\u4e0a\u4f20{0}\u4e2a\u6587\u4ef6\uff0c\u8bf7\u5220\u51cf\u540e\u91cd\u8bd5!",hashing:"\u6b63\u5728\u6548\u9a8c\u6587\u4ef6...",hash_success:"\u4e91\u7aef\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u6587\u4ef6\u79d2\u4f20\u6210\u529f!",error:"\u5931\u8d25",num_limit:"\u53ea\u80fd\u4e0a\u4f20{0}\u4e2a\u6587\u4ef6!",allsize_limit:"\u6587\u4ef6\u603b\u5927\u5c0f\u8d85\u51fa!",filesize_limite:"\u6587\u4ef6\u5927\u5c0f\u8d85\u51fa {0}!",duplicate:"\u4e0a\u4f20\u961f\u5217\u4e2d\u6709\u91cd\u590d\u6587\u4ef6!"},"undefined"==typeof e.baseuri)throw"this javascript file need behind 'common.js'";var a=document.getElementsByTagName("script"),i=e.deparam.querystring(a[a.length-1].src);e.session_id=i.session_id,e.fn.extend({uploader:function(a,i,t,r,s,n){a!==!0&&(a="undefined"==typeof max_widt?0:parseFloat(a)),i="undefined"==typeof max_heigh?0:parseFloat(i),t="undefined"==typeof filesiz?2097152:t,r="undefined"==typeof filetyp?"jpg,jpeg,png,bmp,gif,webp,svg":r.toLowerCase(),s=isNaN(s)?1:parseInt(s);var l=["jpg","jpeg","png","bmp","gif","webp","svg"];return this.each(function(){var o=e(this),d=o.prop("flex_uploader")?o.prop("flex_uploader"):{};if(d&&d.uploader&&(delete d.uploader,d.$container.remove(),o.removeProp("flex_uploader")),a!==!0){var p={},u=function(){return rand(1e4,99999)},c="uploader-id-"+u(),f="pick-id-"+u(),g=c+"-progresses",m=c+"-thumbnails";d.$container=e('<div class="uploader-container" id="'+c+'"><div class="drop-tips text-info"><h2>'+e.UPLOADER_LANGUAGE.drop_container+'</h2><br /><br /><div class="btn btn-info" onclick="javascript:jQuery(this).parent().hide().parent(\'.uploader-container\').removeClass(\'webuploader-dnd-over\');"><i class="glyphicon glyphicon-remove"></i> '+e.UPLOADER_LANGUAGE.close+'</div></div><div class="pull-left"><span id="'+f+'">'+e.UPLOADER_LANGUAGE.select_file+"(\u2264 "+bytesToSize(t)+')</span></div><div class="pull-left tags">&nbsp;<span class="label label-success">.'+r.replace(/,/g,'</span>&nbsp;<span class="label label-success">.')+'</span>&nbsp;<span class="label label-warning enable-tooltip" data-placement="top" title="'+e.UPLOADER_LANGUAGE.ctrl_v_tips+'"><small class="glyphicon glyphicon-info-sign"></small> '+e.UPLOADER_LANGUAGE.ctrl_v_button+'</span>&nbsp;<span class="label label-warning enable-tooltip" data-placement="top" title="'+e.UPLOADER_LANGUAGE.drop_container+'"><small class="glyphicon glyphicon-info-sign"></small> '+e.UPLOADER_LANGUAGE.drop_button+"</span>"+(a>0&&i>0?"<br /><small>&nbsp;"+e.UPLOADER_LANGUAGE.resize.replace("{0}",a.toString().toHTML()+"x"+i.toString().toHTML())+"</small>":"")+'</div><div class="clearfix"></div><div id="'+g+'" class="progresses"></div><div class="clearfix"></div><div id="'+m+'" class="thumbnails row"></div><div class="clearfix"></div></div>').insertAfter(o),"undefined"!=typeof e.fn.tooltip&&e(".enable-tooltip",d.$container).tooltip();var h={},v=function(a){return h[a.id]||(h[a.id]=e('<div class="media alert alert-warning fade in"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="media-left media-middle"><img class="media-object" src="" alt=""></div><div class="media-body"><h4 class="media-heading">'+a.name.toHTML()+"("+bytesToSize(a.size)+')</h4><div class="media-message"></div><div class="progress"><div class="progress-bar progress-bar-warning progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%"><span class=""></span></div></div></div></div>').appendTo("#"+g).on("closed.bs.alert",function(){"complete"==a.getStatus()?v(a).remove():v(a).cancel()})),{init:function(){return h[a.id].removeClass("alert-info alert-danger alert-success alert-warning"),this},initProgress:function(){e(".progress-bar",h[a.id]).removeClass("progress-bar-info progress-bar-danger progress-bar-success progress-bar-warning")},thumb:function(){d.uploader.makeThumb(a,function(i,t){e(".media-object",h[a.id]).attr("src",i?e.baseuri+"placeholder?text="+a.ext+"&size=75x75&fontsize=35":t)})},name:function(i){return e(".progressName",h[a.id]).html(i.toHTML()),this},message:function(i){return e(".media-message",h[a.id]).html(i),this},error:function(i){return this.init(),this.initProgress(),a.setStatus("invalid"),h[a.id].addClass("alert-danger"),e(".progress-bar",h[a.id]).addClass("progress-bar-danger"),this.message(i)},progressing:function(i,t){this.init(),this.initProgress(),h[a.id].addClass("alert-info"),i=i.toFixed(2);var r=e(".progress-bar",h[a.id]).width(i+"%");return e(".progress-bar span",h[a.id]).text(i+"%"),i<20?r.addClass("progress-bar-warning"):i<95?r.addClass("progress-bar-info"):r.addClass("progress-bar-success"),i<100?r.addClass("active"):r.removeClass("active"),this.message(e.UPLOADER_LANGUAGE.uploading)},success:function(){return this.progressing(100),this.init(),h[a.id].addClass("alert-success"),h[a.id].delay(1500).queue(function(){e(this).alert("close").dequeue()}),this.message(e.UPLOADER_LANGUAGE.success)},cancel:function(){return d.uploader.cancelFile(a),this.remove()},remove:function(){return h[a.id].remove(),delete h[a.id],this}}},b={},A=function(a,i,t){if("undefined"!=typeof a&&"undefined"==typeof b[a])if(b[a]=e('<div class="col-xs-6 col-md-4 alert"><div class="thumbnail"><div class="file-panel"><span class="cancel" data-dismiss="alert" aria-label="Close">'+e.UPLOADER_LANGUAGE.close+'</span><span class="rotateRight">'+e.UPLOADER_LANGUAGE.rotate_right+'</span><span class="rotateLeft">'+e.UPLOADER_LANGUAGE.rotate_left+'</span></div><a href="'+e.baseuri+"attachment?id="+a+'"  target="_blank"><img src="'+e.baseuri+"placeholder?size=300x200&text="+encodeURIComponent(e.UPLOADER_LANGUAGE.loading)+'" alt="" class="img-responsive center-block"  onerror="this.src=\''+e.baseuri+"placeholder?size=300x200&text='+encodeURIComponent('"+e.UPLOADER_LANGUAGE.reading+'\');"></a><div class="caption"><h4><span class="title">'+(i?i.toHTML():"")+'</span><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></h4></div><div class="clearfix"></div></div><div class="clearfix"></div></div>').appendTo("#"+m).on("closed.bs.alert",function(){A(a).remove()}),e(".rotateLeft,.rotateRight",b[a]).on("click",function(){var i=parseInt(b[a].data("rotation"))||0;i+=e(this).is(".rotateLeft")?-90:90,deg="rotate("+i+"deg)",e("img",b[a]).css(e.supportTransition?{"-webkit-transform":deg,"-mos-transform":deg,"-o-transform":deg,transform:deg}:{filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation="+~~(i/90%4+4)%4+")"}),b[a].data("rotation",i)}),t){var r=l.indexOf(t.toLowerCase())>-1?e.baseuri+"attachment/preview?id="+a:e.baseuri+"placeholder?size=300x200&text="+encodeURIComponent(t);e("img",b[a]).attr("src",r)}else e.GET(e.baseuri+"attachment/info?id="+a,null,function(i){if("undefined"!=typeof i&&("success"==i.result||"api"==i.result)&&"undefined"!=typeof i.data.ext){var t=l.indexOf(i.data.ext.toLowerCase())>-1?e.baseuri+"attachment/preview?id="+a:e.baseuri+"placeholder?size=300x200&text="+encodeURIComponent(i.data.ext);e(".title",b[a]).text(i.data.displayname),e("img",b[a]).attr("src",t)}});return{build:function(){return o.triggerHandler("uploader.previewing",[this.getFile(),a,_().get()])===!1?this:(_().add(a),o.triggerHandler("uploader.previewed",[this.getFile(),a,_().get()]),this)},remove:function(){var e=this.getFile();return o.triggerHandler("uploader.removing",[e,a,_().get()])===!1?this:(e&&d.uploader.removeFile(e,!0),_().remove(a),b[a].remove(),delete b[a],o.triggerHandler("uploader.removed",[e,a,_().get()]),this)},setFile:function(e){return b[a].data("file",e),this},getFile:function(){return b[a].data("file")},removeAll:function(){for(var e in b)A(e).remove()},rebuildAll:function(){files=d.uploader.getFiles();for(var e=0;e<files.length;e++)d.uploader.removeFile(files[e],!0);this.removeAll();var a=_().get();for(e=0;e<a.length;e++)A(a[e]).build();return this}}},_=function(){var e=o.val();return"0"==e&&(e=""),aids=e?e instanceof Array?e:e.split(","):[],{write:function(){return o.is("select")&&(o.empty(),aids.forEach(function(e){o.append('<option value="'+e+'">'+e+"</option>")})),o.val(aids),this},add:function(e){1==s&&(aids=[e.toString()]);var a=aids.indexOf(e.toString());return a==-1&&aids.push(e.toString()),this.write()},remove:function(e){var a=aids.indexOf(e.toString());return a!=-1&&aids.splice(a,1),this.write()},removeAll:function(){return aids=[],this.write()},get:function(){return aids}}};p.beforeFileQueued=function(a){return r.split(",").indexOf(a.ext.toLowerCase())==-1?(e.alert(e.UPLOADER_LANGUAGE.filetype.replace("{0}",r)),!1):!(s>1&&_().get().length>=s)||(e.alert(e.UPLOADER_LANGUAGE.filenum_limite.replace("{0}",s)),!1)},p.fileQueued=function(t){return o.triggerHandler("uploader.uploading",[t,_().get()])!==!1&&(v(t).init().thumb(),a>0&&i>0&&("jpg"==t.ext||"jpeg"==t.ext)?(d.uploader.upload(t),!0):(this.md5File(t).progress(function(a){v(t).progressing(0).message(e.UPLOADER_LANGUAGE.hashing+" "+(100*a).toFixed(2)+"%")}).then(function(a){e.POST(e.baseuri+"attachment/hash_query",{hash:a,_token:e.csrf,filename:t.name,ext:t.ext,size:t.size},function(i){"undefined"==typeof i||"success"!=i.result&&"api"!=i.result?(t.md5=a,d.uploader.upload(t)):(d.uploader.skipFile(t),v(t).success().message(e.UPLOADER_LANGUAGE.hash_success),1==s&&A().removeAll(),A(i.data.id,i.data.displayname,i.data.ext).build().setFile(t),o.triggerHandler("uploader.uploaded",[t,i,_().get()]))},!1)}),!0))},p.uploadBeforeSend=function(e,a,i){a.uuid=e.blob.ruid+e.file.id+e.file.size,a.start=e.start,a.end=e.end,a.chunks=e.chunks,a.chunk=e.chunk,a.total=e.file.size,a.hash=e.file.md5},p.uploadStart=function(e){},p.uploadProgress=function(e,a){o.triggerHandler("uploader.progressing",[e,a,_().get()]),v(e).progressing(a)},p.uploadSuccess=function(a,i){!i||"success"!=i.result&&"api"!=i.result?(v(a).error(e.UPLOADER_LANGUAGE.error+": "+i.message.content),o.triggerHandler("uploader.error",[a,i.message.content,_().get()])):(v(a).success(),1==s&&A().removeAll(),A(i.data.id,i.data.displayname,i.data.ext).build().setFile(a),o.triggerHandler("uploader.uploaded",[a,i,_().get()]))},p.uploadError=function(a,i){v(a).error(e.UPLOADER_LANGUAGE.error+": "+i),o.triggerHandler("uploader.error",[a,i,_().get()])},p.uploadComplete=function(e){},p.error=function(a,i,s){switch(a){case"Q_EXCEED_NUM_LIMIT":e.alert(e.UPLOADER_LANGUAGE.num_limit.replace("{0}",i));break;case"Q_EXCEED_SIZE_LIMIT":e.alert(e.UPLOADER_LANGUAGE.allsize_limit);break;case"F_EXCEED_SIZE":e.alert(e.UPLOADER_LANGUAGE.filesize_limite.replace("{0}",bytesToSize(t)));break;case"F_DUPLICATE":e.alert(e.UPLOADER_LANGUAGE.duplicate);break;case"Q_TYPE_DENIED":e.alert(e.UPLOADER_LANGUAGE.filetype.replace("{0}",r));break;default:e.alert(a)}},p.create=function(){d.uploader||"undefined"==typeof o.prop("flex_uploader")||(d.uploader=WebUploader.create({swf:e.baseuri+"static/js/webuploader/Uploader.swf",server:e.baseuri+"attachment/uploader_query?of=json",pick:{id:"#"+f,multiple:!0},formData:e.extend(e.session_id?{PHPSESSIONID:e.session_id}:{},e.csrf?{_token:e.csrf}:{},{}),fileVal:"Filedata",method:"POST",sendAsBinary:!1,fileNumLimit:0,fileSingleSizeLimit:t,duplicate:!1,accept:{title:e.UPLOADER_LANGUAGE.select_file,extensions:r,mimeTypes:"undefined"!=typeof mimeType?r.split(",").map(function(e){return mimeType.lookup("name."+e)}).join(","):"*/*"},prepareNextFile:!0,chunkSize:5242880,chunkRetry:5,chunked:!0,threads:3,dnd:"#"+c,disableGlobalDnd:!0,paste:document.body,thumb:{width:75,height:75,quality:70,allowMagnify:!1,crop:!0},resize:!1,compress:null}),a>0&&i>0&&d.uploader.option("compress",{width:a,height:i,quality:100,allowMagnify:!1,crop:!1,preserveHeaders:!0,noCompressIfLarger:!0,compressSize:0}),d.uploader.on("beforeFileQueued",p.beforeFileQueued),d.uploader.on("fileQueued",p.fileQueued),d.uploader.on("uploadBeforeSend",p.uploadBeforeSend),d.uploader.on("uploadStart",p.uploadStart),d.uploader.on("uploadProgress",p.uploadProgress),d.uploader.on("uploadSuccess",p.uploadSuccess),d.uploader.on("uploadError",p.uploadError),d.uploader.on("uploadComplete",p.uploadComplete),d.uploader.on("error",p.error),n&&_().add(n),A().rebuildAll())},o.prop("flex_uploader",d),d.$container.is(":visible")?p.create():p.interval=setInterval(function(){d.$container.is(":visible")&&(clearInterval(p.interval),p.create())},1e3)}})}})}(jQuery);
//# sourceMappingURL=jquery.uploader.min.js.map
