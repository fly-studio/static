var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,o){function s(t){try{h(n.next(t))}catch(e){o(e)}}function a(t){try{h(n["throw"](t))}catch(e){o(e)}}function h(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(s,a)}h((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(r)throw new TypeError("Generator is already executing.");for(;h;)try{if(r=1,o&&(s=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,o=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){h.label=i[1];break}if(6===i[0]&&h.label<s[1]){h.label=s[1],s=i;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(i);break}s[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(n){i=[6,n],o=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,o,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},__values=this&&this.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],i=0;return e?e.call(t):{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}}},__read=this&&this.__read||function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,o=i.call(t),s=[];try{for(;(void 0===e||e-->0)&&!(n=o.next()).done;)s.push(n.value)}catch(a){r={error:a}}finally{try{n&&!n.done&&(i=o["return"])&&i.call(o)}finally{if(r)throw r.error}}return s},__spread=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t},layer;!function(t){var e;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.once(egret.Event.ADDED_TO_STAGE,e.onAddedToStage,e),e.once(egret.Event.REMOVED_FROM_STAGE,e.onRemovedFromStage,e),e}return __extends(e,t),Object.defineProperty(e.prototype,"position",{get:function(){return new egret.Point(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y},enumerable:!0,configurable:!0}),e.prototype.getStage=function(){return this.stage instanceof egret.Stage?this.stage:egret.lifecycle.stage},e.prototype.addToStage=function(t){t=null==this.stage?this.getStage():t,t.addChild(this)},e.prototype.destroy=function(){this.parent&&this.parent.removeChild(this)},e}(egret.Sprite);t.Sprite=e,__reflect(e.prototype,"layer.ui.Sprite")}(e=t.ui||(t.ui={}))}(layer||(layer={}));var layer;!function(t){var e;!function(e){var i=function(t){function e(){var e=t.call(this)||this;return e._readyReses=[],e}return __extends(e,t),Object.defineProperty(e.prototype,"readyRes",{get:function(){return this._readyReses},set:function(t){this._readyReses=t},enumerable:!0,configurable:!0}),e}(t.ui.Sprite);e.Ready=i,__reflect(i.prototype,"layer.ui.Ready")}(e=t.ui||(t.ui={}))}(layer||(layer={}));var layer;!function(t){var e;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i._duration=0,i._duration=t,i._remaining=t,i.fromTime=null,i.paused=!1,i.promise=null,i}return __extends(i,e),Object.defineProperty(i.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"remaining",{get:function(){return this._remaining},enumerable:!0,configurable:!0}),i.prototype.resolvePromise=function(){this.promise&&(this.promise.resolve(this.remaining),delete this.promise,this.promise=null)},i.prototype.rejectPromise=function(){this.promise&&(this.promise.reject(this.remaining),delete this.promise,this.promise=null)},i.prototype.clearTimer=function(){this.timer&&(this.timer.stop(),this.timer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this),delete this.timer,this.timer=null)},i.prototype.remainingPromise=function(){return this.promise?this.promise.promise():(this.promise=new DeferredPromise,this.promise.promise())},i.prototype.onTimer=function(e){this.paused||(this._remaining=this._duration-Date.now()+this.fromTime,this.remaining<=0?(t.CountdownEvent.dispatchCountdownEvent(this,t.CountdownEvent.COMPLETE),this.clearTimer(),this._remaining=0):t.CountdownEvent.dispatchCountdownEvent(this,t.CountdownEvent.COUNTDOWN),this.resolvePromise())},i.prototype.start=function(t){void 0===t&&(t=500),this.clearTimer(),this.fromTime=Date.now(),this._remaining=this._duration,this.paused=!1,this.timer=new egret.Timer(t,0),this.timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.timer.start()},i.prototype.reset=function(){this.clearTimer(),this._remaining=this._duration,t.CountdownEvent.dispatchCountdownEvent(this,t.CountdownEvent.RESET)},i.prototype.pause=function(){this.paused=!0,this.timer&&this.timer.reset(),t.CountdownEvent.dispatchCountdownEvent(this,t.CountdownEvent.PAUSE)},i.prototype.resume=function(){this.paused=!1,this.fromTime=Date.now()-this._duration+this.remaining,this.timer&&this.timer.start(),t.CountdownEvent.dispatchCountdownEvent(this,t.CountdownEvent.RESUME)},i.prototype.stop=function(){this.clearTimer(),this.rejectPromise(),this.paused=!1,this._remaining=0,t.CountdownEvent.dispatchCountdownEvent(this,t.CountdownEvent.STOP)},i}(egret.EventDispatcher);t.Countdown=e,__reflect(e.prototype,"layer.timer.Countdown")}(e=t.timer||(t.timer={}))}(layer||(layer={}));var layer;!function(t){var e;!function(e){var i=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.duration=0,t.remaining=0,t}return __extends(i,e),i.dispatchCountdownEvent=function(e,n,r,o){if(!(e instanceof t.timer.Countdown))throw new Error("target must be an instance of layer.timer.Countdown");var s=egret.Event.create(i,n,r,o);s.duration=e.duration,s.remaining=e.remaining;var a=e.dispatchEvent(s);return egret.Event.release(s),a},i.START="START",i.STOP="STOP",i.RESET="RESET",i.COUNTDOWN="COUNTDOWN",i.PAUSE="PAUSE",i.RESUME="RESUME",i}(egret.Event);e.CountdownEvent=i,__reflect(i.prototype,"layer.timer.CountdownEvent")}(e=t.timer||(t.timer={}))}(layer||(layer={}));var layer;!function(t){var e;!function(t){var e=function(t){function e(e){var i=t.call(this)||this;return i.texture=RES.getRes(e),i}return __extends(e,t),e}(egret.Bitmap);t.BitmapUI=e,__reflect(e.prototype,"layer.ui.BitmapUI")}(e=t.ui||(t.ui={}))}(layer||(layer={}));var layer;!function(t){var e;!function(e){var i=function(t){function e(e){var i=t.call(this)||this;return i.soundRes=e,i}return __extends(e,t),e.prototype.onAddedToStage=function(t){this.graphics.beginFill(0,0),this.graphics.drawRect(0,0,this.width,this.height),this.graphics.endFill(),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.onRemovedFromStage=function(t){this.removeAllEventListeners()},e.prototype.removeAllEventListeners=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.onTap=function(t){if(this.soundRes){var e=RES.getRes(this.soundRes);e&&e.play(0,1)}},e}(t.ui.Sprite);e.BlankButtonUI=i,__reflect(i.prototype,"layer.ui.BlankButtonUI")}(e=t.ui||(t.ui={}))}(layer||(layer={}));var layer;!function(t){var e;!function(e){var i=function(e){function i(t,i){var n=e.call(this)||this;return n.bmpRes=t,n.soundRes=i,n}return __extends(i,e),i.prototype.onAddedToStage=function(e){this.addChild(new t.ui.BitmapUI(this.bmpRes)),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},i.prototype.onRemovedFromStage=function(t){this.removeAllEventListeners()},i.prototype.removeAllEventListeners=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},i.prototype.onTap=function(t){if(this.soundRes){var e=RES.getRes(this.soundRes);e&&e.play(0,1)}},i}(t.ui.Sprite);e.ButtonUI=i,__reflect(i.prototype,"layer.ui.ButtonUI")}(e=t.ui||(t.ui={}))}(layer||(layer={}));var layer;!function(t){var e;!function(e){var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onAddedToStage=function(t){},e.prototype.onRemovedFromStage=function(t){},e.prototype.removeAllEventListeners=function(){},e}(t.ui.Sprite);e.CountdownUI=i,__reflect(i.prototype,"layer.ui.CountdownUI")}(e=t.ui||(t.ui={}))}(layer||(layer={}));var layer;!function(t){var e;!function(e){var i=function(){function e(){this.method="post",this.action="",this.autoTip=!0,this.fields=[]}return Object.defineProperty(e.prototype,"data",{get:function(){var t=new FormData;return this.fields.forEach(function(e){e instanceof egret.TextField&&t.append(e.name,e.text)}),t},enumerable:!0,configurable:!0}),e.prototype.addInput=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];e.forEach(function(e){return t.fields.push(e)})},e.prototype.submit=function(){return t.http.request(this.method,this.action,this.data,this.autoTip)},e}();e.Form=i,__reflect(i.prototype,"layer.ui.Form")}(e=t.ui||(t.ui={}))}(layer||(layer={}));var layer;!function(t){var e;!function(e){function i(e){return new Promise(function(i,n){var r=new t.ui.TipUI;r.title="提示",r.content=e,r.buttons=[{text:"OK",onClick:function(){r.destroy(),i()}}],r.addToStage()})}function n(e){return new Promise(function(i,n){var r=new t.ui.TipUI;r.title="请求",r.content=e,r.buttons=[{text:"取消",onClick:function(){r.destroy(),n()}},{text:"确定",onClick:function(){r.destroy(),i()}}],r.addToStage()})}e.alert=i,e.confirm=n}(e=t.ui||(t.ui={}))}(layer||(layer={}));var layer;!function(t){var e;!function(e){var i=function(t){function e(e){void 0===e&&(e="");var i=t.call(this)||this;return i.resURI=e.length>0?e:void 0!=window.resURI?window.resURI:"",i.resURI.length>0&&"/"!=i.resURI.substring(i.resURI.length-1)&&(i.resURI+="/"),i._configList=[],i._groupList=[],i._themeList=[],i.status=new Map,RES.setMaxLoadingThread(3),i}return __extends(e,t),Object.defineProperty(e.prototype,"configList",{get:function(){return this._configList},set:function(t){this._configList=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"themeList",{get:function(){return this._themeList},set:function(t){this._themeList=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groupList",{get:function(){return this._groupList},set:function(t){this._groupList=t},enumerable:!0,configurable:!0}),e.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,n,r,o,s,a,r,h,u,l,r,c,d,p,f,g,v;return __generator(this,function(y){switch(y.label){case 0:if(this._configList.length+this._groupList.length+this._themeList.length<=0)throw new Error("Please set configList/groupList/themeList first.");t=[];try{for(e=__values(this._configList),i=e.next();!i.done;i=e.next())n=i.value,r=this.loadConfig(n),t.push(r.promise())}catch(m){c={error:m}}finally{try{i&&!i.done&&(d=e["return"])&&d.call(e)}finally{if(c)throw c.error}}return[4,Promise.all(t)];case 1:y.sent(),t=[];try{for(o=__values(this._themeList),s=o.next();!s.done;s=o.next())a=s.value,r=this.loadTheme(a),t.push(r.promise())}catch(E){p={error:E}}finally{try{s&&!s.done&&(f=o["return"])&&f.call(o)}finally{if(p)throw p.error}}return[4,Promise.all(t)];case 2:y.sent(),t=[];try{for(h=__values(this._groupList),u=h.next();!u.done;u=h.next())l=u.value,r=this.loadGroup(l),t.push(r.promise())}catch(_){g={error:_}}finally{try{u&&!u.done&&(v=h["return"])&&v.call(h)}finally{if(g)throw g.error}}return[4,Promise.all(t)];case 3:return[2,y.sent()]}})})},e.prototype.onAddedToStage=function(t){this.removeChildren(),this.graphics.clear(),this.textField=new egret.TextField,this.textField.y=(this.stage.stageHeight-100)/2,this.textField.width=this.stage.stageWidth,this.textField.height=100,this.textField.textAlign=egret.HorizontalAlign.CENTER,this.textField.verticalAlign=egret.VerticalAlign.MIDDLE,this.addChild(this.textField),this.bindEvents()},e.prototype.onRemovedFromStage=function(t){this.removeAllEventListeners(),this.status.clear(),this._configList=[],this._groupList=[],this._themeList=[]},e.prototype.removeAllEventListeners=function(){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.removeEventListener(RES.ResourceEvent.CONFIG_LOAD_ERROR,this.onConfigError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this)},e.prototype.bindEvents=function(){RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.CONFIG_LOAD_ERROR,this.onConfigError,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this)},e.prototype.setProgress=function(t,e,i){if(this.textField){var n=e>0?t/e*100:0;n>100&&(n=100),this.textField.text="Loading..."+Math.round(n)+"%"}},e.prototype.loadConfig=function(t){var e=new DeferredPromise,i=t.resourceFile,n=t.path;return void 0==n&&(n=i.replace(/\\/g,"/").replace(/\/[^\/]*\/?$/,"")+"/"),i=this.resURI+i,n=this.resURI+n,this.status.set("config: "+i,{dfd:e,loaded:0,total:1}),RES.loadConfig(i,n),e},e.prototype.loadTheme=function(t){var e=new DeferredPromise;t=this.resURI+t,this.status.set("theme: "+t,{dfd:e,loaded:0,total:1});var i=new eui.Theme(t,this.getStage());return i.once(eui.UIEvent.COMPLETE,function(){e.resolve()},this),e},e.prototype.loadGroup=function(t){var e=new DeferredPromise;return this.status.set(t,{dfd:e,loaded:0,total:RES.getGroupByName(t).length}),RES.loadGroup(t),e},e.prototype.onConfigError=function(t){},e.prototype.onConfigComplete=function(t){},e.prototype.onResourceLoadComplete=function(t){if(this.status.has(t.groupName)){var e=this.status.get(t.groupName);e.dfd.resolve(t.groupName),e.loaded=e.total}},e.prototype.onItemLoadError=function(t){if("RES__CONFIG"==t.groupName){var e="config: "+(t.resItem&&t.resItem.name?t.resItem.name:"");if(this.status.has(e)){var i=this.status.get(e);i.loaded=0,i.dfd.reject(t.resItem.name)}}},e.prototype.onResourceLoadError=function(t){RES.ResourceEvent.dispatchResourceEvent(t.target,RES.ResourceEvent.GROUP_COMPLETE,t.groupName)},e.prototype.onResourceProgress=function(t){var e=t.groupName;if("RES__CONFIG"==t.groupName){if(e="config: "+(t.resItem&&t.resItem.name?t.resItem.name:""),this.status.has(e)){var i=this.status.get(e);t.resItem.loaded?(i.loaded=1,i.dfd.resolve(t.resItem.name)):i.dfd.reject(t.resItem.name)}}else if(this.status.has(e)){var n=this.status.get(e);n.loaded=t.itemsLoaded}var r=0,o=0;this.status.forEach(function(t){r+=t.total,o+=t.loaded}),this.setProgress(o,r,t.resItem)},e}(t.ui.Sprite);e.LoadingUI=i,__reflect(i.prototype,"layer.ui.LoadingUI")}(e=t.ui||(t.ui={}))}(layer||(layer={}));var layer;!function(t){var e;!function(e){var i;!function(e){function i(e,i,n){var r=i instanceof Object?i:{content:i.toString()};switch(n.type){case"redirect":setTimeout(function(){self.location.href=n.url},n.timeout);break;case"refresh":case"back":case"toast":}return new Promise(function(e,i){var o=new t.ui.TipUI;switch(null!=r.title&&(o.title=r.title),o.content=r.content,isNaN(n.timeout)||(o.timeout=n.timeout),n.type){case"redirect":o.buttons=[{text:"Go",onClick:function(){o.destroy(),e(),self.location.href=n.url}}];break;case"back":o.buttons=[{text:"返回",onClick:function(){o.destroy(),e()}}]}o.addToStage()})}e.tip=i}(i=e.lp||(e.lp={}))}(e=t.ui||(t.ui={}))}(layer||(layer={}));var layer;!function(t){var e;!function(e){var i=function(t){function e(e,i){void 0===e&&(e=0),void 0===i&&(i=.8);var n=t.call(this)||this;return n.graphics.beginFill(e,i),n.graphics.drawRect(0,0,n.getStage().stageWidth,n.getStage().stageHeight),n.graphics.endFill(),n}return __extends(e,t),e.prototype.addToStage=function(t){},e.prototype.onAddedToStage=function(t){},e.prototype.onRemovedFromStage=function(t){},e.prototype.removeAllEventListeners=function(){},e}(t.ui.Sprite);e.MaskUI=i,__reflect(i.prototype,"layer.ui.MaskUI")}(e=t.ui||(t.ui={}))}(layer||(layer={}));var httpQuery=http.Query,httpObjectToForm=http.objectToForm,layer;!function(t){var e;!function(e){function i(i,n,r,o){return void 0===r&&(r={}),void 0===o&&(o=!1),new Promise(function(s,a){var h=new httpQuery(e.baseURI);h.request(i,n,r).then(function(e){var i=e.data;o&&t.ui.lp.tip(i.result,i.message,i.tipType),"success"==i.result||"api"==i.result?s(i):a(i)},function(e){o&&t.ui.alert(e instanceof Error?e.message:e.toString()),a(e)})})}function n(t,e,n){return void 0===n&&(n=!1),i("post",t,httpObjectToForm(e),n)}function r(t,e,n){return void 0===n&&(n=!1),i("get",t,e,n)}function o(t,e,n){return void 0===n&&(n=!1),i("post",t,e,n)}function s(t,e,n){return void 0===n&&(n=!1),i("put",t,e,n)}function a(t,e,n){return void 0===n&&(n=!1),i("patch",t,e,n)}function h(t,e,n){return void 0===n&&(n=!1),i("head",t,e,n)}function u(t,e,n){return void 0===n&&(n=!1),i("options",t,e,n)}function l(t,e,n){return void 0===n&&(n=!1),i("delete",t,e,n)}e.baseURI="undefined"!=typeof window.baseURI?window.baseURI:"",e.request=i,e.form=n,e.get=r,e.post=o,e.put=s,e.patch=a,e.head=h,e.options=u,e.DELETE=l,e["delete"]=l}(e=t.http||(t.http={}))}(layer||(layer={}));var layer;!function(t){var e;!function(e){var i=function(t){function i(){var e=t.call(this)||this;return e.titleHeight=70,e.contentPadding=15,e.buttonMaxHeight=75,e.options={textColor:0,fontFamily:"Microsoft Yahei",backgoundColor:16777215,title:"",content:"",timeout:1/0,buttons:[],width:0,height:0},e}return __extends(i,t),Object.defineProperty(i.prototype,"textColor",{get:function(){return this.options.textColor},set:function(t){this.options.textColor=t>=0&&16777215>=t?t:0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fontFamily",{get:function(){return this.options.fontFamily||"Microsoft Yahei"},set:function(t){this.options.fontFamily=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"backgoundColor",{get:function(){return this.options.backgoundColor},set:function(t){this.options.backgoundColor=t>=0&&16777215>=t?t:16777215},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"title",{get:function(){return this.options.title},set:function(t){this.options.title=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"content",{get:function(){return this.options.content},set:function(t){this.options.content=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"timeout",{get:function(){return this.options.timeout===1/0&&this.options.buttons.length<=0?1500:this.options.timeout},set:function(t){this.options.timeout=t>0?t:0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"buttons",{get:function(){return this.options.buttons},set:function(t){this.options.buttons=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clientWidth",{get:function(){return this.options.width<=0||this.options.width>this.stage.stageWidth?.75*this.stage.stageWidth:this.options.width},set:function(t){this.options.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clientHeight",{get:function(){return this.options.height<=0||this.options.height<this.titleHeight+this.buttonMaxHeight?.9*this.stage.stageHeight:this.options.height},set:function(t){this.options.height=t},enumerable:!0,configurable:!0}),i.prototype.onAddedToStage=function(t){this.removeChildren(),this.graphics.clear(),this.addChild(new e.MaskUI(0,.25)),this.tipSprite=new egret.Sprite,this.addChild(this.tipSprite),this.renderClient(),this.bindEvents(),this.timeoutDisappear()},i.prototype.onRemovedFromStage=function(t){this.removeAllEventListeners()},i.prototype.renderClient=function(){this.removeAllEventListeners(),this.tipSprite.removeChildren(),this.tipSprite.graphics.clear(),this.title.length<=0&&(this.titleHeight=0);var t=new egret.HtmlTextParser,e=this.buttons.length>0?this.buttonMaxHeight:0,i=this.clientHeight-this.titleHeight-e,n=new egret.TextField;n.textColor=this.textColor,n.fontFamily=this.fontFamily,n.size=24,n.textFlow=t.parse(this.content),n.textAlign=egret.HorizontalAlign.LEFT,n.verticalAlign=egret.VerticalAlign.TOP,n.width=this.clientWidth-2*this.contentPadding,n.height<150&&(n.height=150),n.height>i-2*this.contentPadding&&(n.height=i-2*this.contentPadding);var r=new egret.Sprite;r.name="content",n.x=this.contentPadding,n.y=this.contentPadding,r.x=0,r.y=this.titleHeight,r.height=n.height+2*this.contentPadding,r.addChild(n),this.clientHeight=this.titleHeight+e+r.height;var o=this.tipSprite;o.graphics.beginFill(this.backgoundColor,.95),o.graphics.drawRoundRect(0,0,this.clientWidth,this.clientHeight,50),o.graphics.endFill();var s=new egret.TextField;s.textColor=this.textColor,s.fontFamily=this.fontFamily,s.size=35,s.textFlow=t.parse(this.title),s.textAlign=egret.HorizontalAlign.CENTER,s.verticalAlign=egret.VerticalAlign.MIDDLE,s.x=this.contentPadding,s.y=0,s.width=o.width-2*this.contentPadding,s.height=this.titleHeight;var a=new egret.Sprite;a.name="title",a.x=0,a.y=0,a.width=o.width,a.height=this.titleHeight,a.graphics.lineStyle(1,13421772),a.graphics.moveTo(0,a.height-1),a.graphics.lineTo(a.width,a.height-1),a.addChild(s);var h=new egret.Sprite;if(h.name="buttons",this.buttons.length>0){h.x=0,h.y=o.height-this.buttonMaxHeight,h.width=this.clientWidth,h.height=this.buttonMaxHeight;var u=h.width/this.buttons.length;h.graphics.lineStyle(1,13421772),h.graphics.moveTo(0,0),h.graphics.lineTo(h.width,0);for(var l=1;l<this.buttons.length;l++)h.graphics.moveTo(u*l,0),h.graphics.lineTo(u*l,h.height);for(var l=0;l<this.buttons.length;l++){var c=new egret.TextField;c.name="button-"+l,c.x=u*l,c.y=1,c.fontFamily=this.fontFamily,c.width=u,c.height=h.height,c.textColor=this.buttons[l].textColor||this.textColor,c.textAlign=egret.HorizontalAlign.CENTER,c.verticalAlign=egret.VerticalAlign.MIDDLE,c.textFlow=t.parse(this.buttons[l].text),h.addChild(c)}}o.addChild(r),o.addChild(a),o.addChild(h),o.x=(this.stage.stageWidth-o.width)/2,o.y=(this.stage.stageHeight-o.height)/2,this.addChild(o)},i.prototype.timeoutDisappear=function(){var t=this;this.interval&&clearTimeout(this.interval),this.timeout!=1/0&&this.timeout>0&&(this.interval=setTimeout(function(){t.destroy()},this.timeout))},i.prototype.bindEvents=function(){var t=this.tipSprite.getChildByName("title");t&&(t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),t.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),t.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this));var e=this.tipSprite.getChildByName("buttons");if(e)for(var i=0;i<e.numChildren;++i){var n=e.getChildAt(i);n.touchEnabled=!0,n.once(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}},i.prototype.removeAllEventListeners=function(){var t=this.tipSprite.getChildByName("title");t&&(t.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),t.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),t.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),t.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this));var e=this.tipSprite.getChildByName("buttons");if(e)for(var i=0;i<e.numChildren;++i){var n=e.getChildAt(i);n.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}},i.prototype.onClick=function(t){t.stopPropagation();var e=t.currentTarget,i=this.tipSprite.getChildByName("buttons");if(i&&this.buttons){var n=i.getChildIndex(e);this.buttons[n].onClick instanceof Function&&this.buttons[n].onClick.call(this,t)}},i.prototype.onTouchBegin=function(t){this.deltaPoint=new egret.Point(t.stageX-this.tipSprite.x,t.stageY-this.tipSprite.y)},i.prototype.onTouchEnd=function(t){this.deltaPoint=null},i.prototype.onTouchMove=function(t){var e=t.stageX-this.deltaPoint.x,i=t.stageY-this.deltaPoint.y;0>e?e=0:e+this.tipSprite.width>this.stage.stageWidth&&(e=this.stage.stageWidth-this.tipSprite.width),0>i?i=0:i+this.tipSprite.height>this.stage.stageHeight&&(i=this.stage.stageHeight-this.tipSprite.height),this.tipSprite.x=e,this.tipSprite.y=i},i}(t.ui.Sprite);e.TipUI=i,__reflect(i.prototype,"layer.ui.TipUI")}(e=t.ui||(t.ui={}))}(layer||(layer={}));var layer;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.onAddedToStage=function(e){var i=this,n=this.stage.stageHeight,r=new egret.Point(this.stage.stageWidth/2,1.5*this.stage.stageHeight);this.addChild(new t.ui.MaskUI(16777215,.5)),this.circleSprite=new egret.Sprite,this.circleSprite.anchorOffsetX=n,this.circleSprite.anchorOffsetY=n,this.circleSprite.x=r.x,this.circleSprite.y=r.y;var o=360/this.readyRes.length;__spread(this.readyRes).reverse().forEach(function(e,r){null==e.duration&&(e.duration=1e3);var s=new t.ui.BitmapUI(e.imageRes);s.anchorOffsetX=s.width/2,s.anchorOffsetY=s.height/2;var a=sharp.circlePoint(new sharp.Point(n,n),n,sharp.d2r(o*r));s.x=a.x,s.y=a.y,s.rotation=o*(r+1),i.circleSprite.addChild(s)}),this.addChild(this.circleSprite)},i.prototype.onRemovedFromStage=function(t){this.removeAllEventListeners()},i.prototype.removeAllEventListeners=function(){},i.prototype.animating=function(){var e=this;return new Promise(function(i){if(0==e.readyRes.length)return e.destroy(),void i();for(var n=egret.Tween.get(e.circleSprite).call(function(){t.media.Sound.play(e.readyRes[0].soundRes)},e).wait(e.readyRes[0].duration/2),r=360/e.readyRes.length,o=function(i){var o=e.readyRes[i];n=n.to({rotation:r*i},o.duration/2).call(function(){t.media.Sound.play(o.soundRes)},e).wait(o.duration/2)},s=1;s<e.readyRes.length;s++)o(s);n.call(function(){e.destroy(),i()},e)})},i}(t.ui.Ready);e.CircleUI=i,__reflect(i.prototype,"layer.ui.ready.CircleUI")}(i=e.ready||(e.ready={}))}(e=t.ui||(t.ui={}))}(layer||(layer={}));var layer;!function(t){var e;!function(t){var e=function(){function t(){}return t.play=function(t,e){void 0===e&&(e=1);var i=RES.getRes(t);i&&i.play(0,e)},t}();t.Sound=e,__reflect(e.prototype,"layer.media.Sound")}(e=t.media||(t.media={}))}(layer||(layer={}));